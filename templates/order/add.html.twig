{% extends 'base.html.twig' %}

{% block javascript %}
    <script src="https://js.stripe.com/v3/"></script>
{% endblock %}

{% block title %}Paiement de ma commande - {% endblock %}

{% block content %}
<h2>Mon récapitulatif</h2>

<div class="row">
    <div class="col-md-6">
        <h3>Mon adresse de livraison</h3>
        <p>{{ delivery|raw }}</p>
        <h3>Mon transporteur</h3>
        <p>{{ carrier.name }} - {{ carrier.description }}</p>
        <p>{{ (carrier.price / 100)|number_format(2, ',', '.') }} €</p>
    </div>
    <div class="col-md-6">
    {% set total = null %}
    {% for key,product in cart %}
        <div class="row">
            <div class="col-2"><img src="/uploads/{{ product.product.illustration }}" height="75px" alt="{{product.product.name}}"></div>
            <div class="col-6">{{product.product.name}} <br/> {{product.product.subtitle}}</div>
            <div class="col-2">x {{ product.quantity }}</div>
            <div class="col-2">{{((product.product.price * product.quantity) / 100)|number_format(2, ',', '.')}} €</div>
        </div>
    {% set total = total + (product.product.price * product.quantity) %}
    {% endfor %}
        <p>Sous-total : {{(total / 100)|number_format(2, ',', '.')}} €</p>
        <p>Livraison : {{(carrier.price / 100)|number_format(2, ',', '.')}} €</p>
        <p>Total : {{ ((total / 100) + (carrier.price / 100))|number_format(2, ',', '.') }} €</p>    
    </div>
    <a href="{{ path('stripe_create_session', {'reference': reference}) }}" class="btn btn-success" id="checkout-button">Payer | {{ ((total / 100) + (carrier.price / 100))|number_format(2, ',', '.') }} €</a>
</div>
{% endblock %}
